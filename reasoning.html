
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Reasoning with imperative programs &#8212; Principles of programming I: Imperative computation (forever alpha) documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=f81aabf2"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'reasoning';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="More C0" href="c0.html" />
    <link rel="prev" title="Warming up with the power function" href="warmup.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
  
    <p class="title logo__title">Principles of programming I: Imperative computation (forever alpha) documentation</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="welcome.html">Welcome</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction to imperative computation</a></li>
<li class="toctree-l1"><a class="reference internal" href="warmup.html">Warming up with the power function</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Reasoning with imperative programs</a></li>
<li class="toctree-l1"><a class="reference internal" href="c0.html">More C0</a></li>
<li class="toctree-l1"><a class="reference internal" href="arrays.html">Arrays</a></li>
<li class="toctree-l1"><a class="reference internal" href="gcd.html">Assignment 1: GCD</a></li>
<li class="toctree-l1"><a class="reference internal" href="practice.html">Practice problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="searching.html">Searching</a></li>
<li class="toctree-l1"><a class="reference internal" href="sorting.html">Sorting - an information theoretic introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="binsearch.html">Binary search</a></li>
<li class="toctree-l1"><a class="reference internal" href="avl.html">AVL trees</a></li>
<li class="toctree-l1"><a class="reference internal" href="lists.html">Linked lists</a></li>
<li class="toctree-l1"><a class="reference internal" href="c.html">Transitioning to C</a></li>
<li class="toctree-l1"><a class="reference internal" href="dict.html">Dictionaries and associated data structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="bitset.html">Bit sets</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/reasoning.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Reasoning with imperative programs</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-a-while-loop">What is a while loop?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#properties-of-the-iteration-function">Properties of the iteration function</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#point-to-reasoning">“Point-to” reasoning</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-fine-point-about-loop-invariant">A fine point about <code class="docutils literal notranslate"><span class="pre">@loop_invariant</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-two-important-questions">The two important questions</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="reasoning-with-imperative-programs">
<h1>Reasoning with imperative programs<a class="headerlink" href="#reasoning-with-imperative-programs" title="Link to this heading">#</a></h1>
<p>So we finished off with the version of our power function inappropriately
named <code class="docutils literal notranslate"><span class="pre">f</span></code> in the form shown below –</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">power_spec</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">power_spec</span><span class="p">{</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="c1">//@requires y &gt;= 0;</span>
<span class="c1">//@ensures \result == power_spec{x,y);</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">y1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">y1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">y1</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">r</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x1</span><span class="p">;</span>
<span class="w">        </span><span class="n">y1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y1</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The above code has a bug in it and in this part, we’ll find out what the
bug is and look at ways to fix it. How do we know there’s a bug in there?
We know that the <code class="docutils literal notranslate"><span class="pre">&#64;ensures</span></code> contract fails when you call <code class="docutils literal notranslate"><span class="pre">f</span></code> with
<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">==</span> <span class="pre">0</span></code>. It seems to work for every value <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">&gt;</span> <span class="pre">0</span></code> (provided the result
is small enough to hold in 31 bits).</p>
<p>The primary object we need to look at here is the while loop. As a method,
we’ll be rewriting/recasting the program in different forms so we can understand
it. This kind of <strong>rewriting to understand*</strong> is very valuable, while a little
risky as well - since you can introduce errors when you rewrite a program. With
practice, and with enough guards such as the contracts we’re placing here,
such “rewriting for understanding” becomes viable.</p>
<section id="what-is-a-while-loop">
<h2>What is a while loop?<a class="headerlink" href="#what-is-a-while-loop" title="Link to this heading">#</a></h2>
<p>All imperative programs that feature a while loop, have it structured
in the following manner</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="p">(</span><span class="o">&lt;&lt;</span><span class="n">condition</span> <span class="n">derived</span> <span class="kn">from</span><span class="w"> </span><span class="nn">state</span><span class="o">&gt;&gt;</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">&lt;&lt;</span><span class="n">steps</span> <span class="n">that</span> <span class="n">modify</span> <span class="n">the</span> <span class="n">state</span><span class="o">&gt;&gt;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In our case, the <code class="docutils literal notranslate"><span class="pre">&lt;&lt;condition</span> <span class="pre">derived</span> <span class="pre">from</span> <span class="pre">state&gt;&gt;</span></code> is <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">&gt;</span> <span class="pre">1</span></code>
and the <code class="docutils literal notranslate"><span class="pre">&lt;&lt;steps</span> <span class="pre">that</span> <span class="pre">modify</span> <span class="pre">the</span> <span class="pre">state&gt;&gt;</span></code> are</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">y1</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">x1</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">x1</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x1</span><span class="p">;</span>
<span class="n">y1</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
</pre></div>
</div>
<p>This block of code can be uderstood as an “iteration function”, which
was presented when discussing recursion in ICT. We’ll recap that here.</p>
<p>A function <span class="math notranslate nohighlight">\(f : \mathcal{A} \longrightarrow \mathcal{A}\)</span> is said to be “iterable” because
it can be used on its own result because its domain and codomain are the
same. Put explicitly, it means you can compute <span class="math notranslate nohighlight">\(f(x)\)</span>, <span class="math notranslate nohighlight">\(f(f(x))\)</span>,
<span class="math notranslate nohighlight">\(f(f(f(x)))\)</span> and so on … which we can express as <span class="math notranslate nohighlight">\(f^n(x)\)</span>.</p>
<p>How is this relevant in our situation? The body of code inside a loop can be
seen as an iterable function that maps the outer function’s state space to the
same state space. In our case, our state space consists of three variables -
<code class="docutils literal notranslate"><span class="pre">x1</span></code>, <code class="docutils literal notranslate"><span class="pre">y1</span></code> and <code class="docutils literal notranslate"><span class="pre">r</span></code>. To see the iteration function for what it is,
we’ll temporarily switch to python as it affords better notation suited
for the purpose.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">pow_iter</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">r1</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">y1</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="n">r1</span> <span class="o">*</span> <span class="n">x1</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x1</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">r1</span>
</pre></div>
</div>
<p>If we label the arguments to reflect that this can be the n-th state
and the output variables to reflect that the result will be the n+1-th state,
we get:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">pow_iter</span><span class="p">(</span><span class="n">xn</span><span class="p">,</span> <span class="n">yn</span><span class="p">,</span> <span class="n">rn</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">yn</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">rnp1</span> <span class="o">=</span> <span class="n">rn</span> <span class="o">*</span> <span class="n">xn</span>
    <span class="n">xnp1</span> <span class="o">=</span> <span class="n">xn</span> <span class="o">*</span> <span class="n">xn</span>
    <span class="n">ynp1</span> <span class="o">=</span> <span class="n">yn</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="n">xnp1</span><span class="p">,</span> <span class="n">ynp1</span><span class="p">,</span> <span class="n">rnp1</span>
</pre></div>
</div>
<p>This is essentially the same function, but is clearer because we don’t have it
clobbering the values of the variables used in the input .. which is a useful
property to have to reason about the code. We’ve also renamed the argument
variables and the result-holding variables as <code class="docutils literal notranslate"><span class="pre">(xn,yn,rn)</span></code> and
<code class="docutils literal notranslate"><span class="pre">(xnp1,ynp1,rnp1)</span></code> respectively to reflect their mathematical notation and
the purpose of <code class="docutils literal notranslate"><span class="pre">pow_iter</span></code> – <span class="math notranslate nohighlight">\((x_n,y_n,r_n)\)</span> and
<span class="math notranslate nohighlight">\((x_{n+1},y_{n+1},r_{n+1})\)</span>. You can also think of the <span class="math notranslate nohighlight">\(n\)</span>
subscript as the row number when we work out the state using a spreadsheet.</p>
<p>In the above form, you can see that the three lines before <code class="docutils literal notranslate"><span class="pre">return</span></code> can be
<strong>reordered in any way</strong> without changing the behaviour of the function.</p>
<p>The full python version of our buggy <code class="docutils literal notranslate"><span class="pre">f</span></code> function can be written as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">y1</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">pow_iter</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">r</span> <span class="o">*</span> <span class="n">x1</span><span class="p">;</span>
</pre></div>
</div>
<p>It isn’t clear at this point how this is useful, but what we’ve done here is to
convince ourselves that we need to understand <code class="docutils literal notranslate"><span class="pre">pow_iter</span></code> to understand <code class="docutils literal notranslate"><span class="pre">f</span></code>.</p>
</section>
<section id="properties-of-the-iteration-function">
<h2>Properties of the iteration function<a class="headerlink" href="#properties-of-the-iteration-function" title="Link to this heading">#</a></h2>
<p>We’ve now transferred part of the responsibility of correctness of <code class="docutils literal notranslate"><span class="pre">f</span></code> to
the correctness of <code class="docutils literal notranslate"><span class="pre">pow_iter</span></code>! So what safety and correctness conditions
would we want of <code class="docutils literal notranslate"><span class="pre">pow_iter</span></code>? Before we get there though, we need to understand
what it is doing and codify it first.</p>
<p>We know that because the <code class="docutils literal notranslate"><span class="pre">pow_iter</span></code> function is used within <code class="docutils literal notranslate"><span class="pre">while</span> <span class="pre">(y1</span> <span class="pre">&gt;</span>
<span class="pre">1)</span></code>, we can be sure that <code class="docutils literal notranslate"><span class="pre">yn</span> <span class="pre">&gt;</span> <span class="pre">1</span></code> internally as well. However, there is
nothing within the function that breaks (i.e. violates some safety condition)
if we supply a <code class="docutils literal notranslate"><span class="pre">yn</span> <span class="pre">&gt;</span> <span class="pre">0</span></code> instead. Therefore the weaker <code class="docutils literal notranslate"><span class="pre">yn</span> <span class="pre">&gt;</span> <span class="pre">0</span></code> condition
suffices for its safety. We don’t need to broaden it beyond that and accept
<code class="docutils literal notranslate"><span class="pre">yn</span> <span class="pre">&lt;</span> <span class="pre">0</span></code> as well because we make no guarantees about <code class="docutils literal notranslate"><span class="pre">f</span></code>’s behaviour for
negative <code class="docutils literal notranslate"><span class="pre">y</span></code>.</p>
<p>There are two cases inside the <code class="docutils literal notranslate"><span class="pre">pow_iter</span></code> function – <code class="docutils literal notranslate"><span class="pre">yn</span></code> is even
and <code class="docutils literal notranslate"><span class="pre">yn</span></code> is odd, and we can split the two cases explicitly to see
what’s going on:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">pow_iter</span><span class="p">(</span><span class="n">xn</span><span class="p">,</span> <span class="n">yn</span><span class="p">,</span> <span class="n">rn</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">yn</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">xnp1</span><span class="p">,</span> <span class="n">ynp1</span><span class="p">,</span> <span class="n">rnp1</span> <span class="o">=</span> <span class="n">xn</span> <span class="o">*</span> <span class="n">xn</span><span class="p">,</span> <span class="n">yn</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">rn</span> <span class="o">*</span> <span class="n">xn</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xnp1</span><span class="p">,</span> <span class="n">ynp1</span><span class="p">,</span> <span class="n">rnp1</span> <span class="o">=</span> <span class="n">xn</span> <span class="o">*</span> <span class="n">xn</span><span class="p">,</span> <span class="n">yn</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">rn</span>
    <span class="k">return</span> <span class="n">xnp1</span><span class="p">,</span> <span class="n">ynp1</span><span class="p">,</span> <span class="n">rnp1</span>
</pre></div>
</div>
<p>The “odd <code class="docutils literal notranslate"><span class="pre">yn</span></code>” case can be made a little mathematically precise without
invoking truncated division like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">pow_iter</span><span class="p">(</span><span class="n">xn</span><span class="p">,</span> <span class="n">yn</span><span class="p">,</span> <span class="n">rn</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">yn</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">xnp1</span><span class="p">,</span> <span class="n">ynp1</span><span class="p">,</span> <span class="n">rnp1</span> <span class="o">=</span> <span class="n">xn</span> <span class="o">*</span> <span class="n">xn</span><span class="p">,</span> <span class="p">(</span><span class="n">yn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">rn</span> <span class="o">*</span> <span class="n">xn</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xnp1</span><span class="p">,</span> <span class="n">ynp1</span><span class="p">,</span> <span class="n">rnp1</span> <span class="o">=</span> <span class="n">xn</span> <span class="o">*</span> <span class="n">xn</span><span class="p">,</span> <span class="n">yn</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">rn</span>
    <span class="k">return</span> <span class="n">xnp1</span><span class="p">,</span> <span class="n">ynp1</span><span class="p">,</span> <span class="n">rnp1</span>
</pre></div>
</div>
<p>Let’s now look at what we’re calculating for even values of <code class="docutils literal notranslate"><span class="pre">yn</span></code>. We
find that we’re (in mathematical terms) calculating <span class="math notranslate nohighlight">\(x_n^2\)</span>,
<span class="math notranslate nohighlight">\(y_n/2\)</span> and <span class="math notranslate nohighlight">\(r_n\)</span>. If you consider <span class="math notranslate nohighlight">\({x_n}^{y_n}\)</span>
and <span class="math notranslate nohighlight">\({x_{n+1}}^{y_{n+1}}\)</span>, we see that the latter is <span class="math notranslate nohighlight">\((x_n^2)^{y_n/2}\)</span>,
which is the same as <span class="math notranslate nohighlight">\({x_n}^{y_n}\)</span>.</p>
<p>Let’s look at the case of odd values of <code class="docutils literal notranslate"><span class="pre">yn</span></code> now. If we try to calculate
<span class="math notranslate nohighlight">\({x_{n+1}}^{y_{n+1}}\)</span>, we get <span class="math notranslate nohighlight">\((x_n^2)^{(y_n-1)/2}\)</span> which gives
<span class="math notranslate nohighlight">\((1/x_n){x_n}^{y_n}\)</span> .. but in this case, there is an extra factor of
<code class="docutils literal notranslate"><span class="pre">xn</span></code> that <code class="docutils literal notranslate"><span class="pre">rn</span></code> gains when we calculate <code class="docutils literal notranslate"><span class="pre">rnp1</span></code>. Therefore if you consider
the combined expression <span class="math notranslate nohighlight">\({r_n}{x_n}^{y_n}\)</span> and
<span class="math notranslate nohighlight">\({r_{n+1}}{x_{n+1}}^{y_{n+1}}\)</span>, we find them to be equal in both cases -
irrespective of whether <code class="docutils literal notranslate"><span class="pre">yn</span></code> is odd or even.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>We call values derived from the state that are unchanged by a
change of state “invariants”. Slightly more formally, for an iterable
function <span class="math notranslate nohighlight">\(f : \mathcal{A} \longrightarrow \mathcal{A}\)</span>, a function
<span class="math notranslate nohighlight">\(g : \mathcal{A} \longrightarrow \mathcal{B}\)</span> is said to be an
“invariant of <span class="math notranslate nohighlight">\(f\)</span>” if <span class="math notranslate nohighlight">\(g(f(x)) = g(x)\)</span> for any valid <span class="math notranslate nohighlight">\(x
\in \mathcal{A}\)</span>. Without loss of generality, we can also take the <span class="math notranslate nohighlight">\(g\)</span>
to be a function that produces a boolean result.</p>
</div>
<p>So the quantity <span class="math notranslate nohighlight">\({r}{x}^{y}\)</span> is an “invariant” of the <code class="docutils literal notranslate"><span class="pre">pow_iter</span></code>
function.</p>
<p>If we then label all the sequentially generated values of
<span class="math notranslate nohighlight">\(\text{pow{\_}iter}^n(x,y,r)\)</span> as <span class="math notranslate nohighlight">\((x_n,y_n,r_n)\)</span>, then we see that,
<span class="math notranslate nohighlight">\({r_{n+1}}{x_{n+1}}^{y_{n+1}} = {r_n}{x_n}^{y_n}\)</span>.</p>
<p><strong>But then, what exactly is this value equal to?</strong></p>
<p>To answer that, all we need to do is to examine the values coming in to our
<code class="docutils literal notranslate"><span class="pre">pow_iter</span></code> the very <strong>first</strong> time we enter the loop – i.e.
<span class="math notranslate nohighlight">\((x_0,y_0,r_0)\)</span>. In that case, we know that <code class="docutils literal notranslate"><span class="pre">r</span> <span class="pre">==</span> <span class="pre">1</span></code> because that’s
what we initialized it to. Therefore the value is simply <span class="math notranslate nohighlight">\(x^y\)</span> – i.e.
the very power function that we wish to compute.  That means that our
<span class="math notranslate nohighlight">\(rx^y\)</span> quantity always has a value equal to the result we want to
compute. So if we run <code class="docutils literal notranslate"><span class="pre">pow_iter</span></code> enough times so that <span class="math notranslate nohighlight">\(y_n = 0\)</span>, then
we know that <span class="math notranslate nohighlight">\({r_n}{x_n}^{y_n} = r_n = x^y\)</span> – i.e. our answer will
simply be in the final value of <code class="docutils literal notranslate"><span class="pre">r</span></code>.</p>
<p>The very last time <code class="docutils literal notranslate"><span class="pre">pow_iter</span></code> gets to run, we have <code class="docutils literal notranslate"><span class="pre">yn</span> <span class="pre">==</span> <span class="pre">1</span></code> and therefore
the final values of <code class="docutils literal notranslate"><span class="pre">(xnp1,ynp1,rnp1)</span></code> are <code class="docutils literal notranslate"><span class="pre">(xnp1,1,rnp1)</span></code>. Therefore, by
our invariant, the answer is simply the expression <code class="docutils literal notranslate"><span class="pre">power_spec(xnp1,1)*rnp1</span></code> ..
which is just <code class="docutils literal notranslate"><span class="pre">rnp1</span> <span class="pre">*</span> <span class="pre">xnp1</span></code>.  So for values of <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">&gt;</span> <span class="pre">1</span></code>, we know that our
<code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">r1</span> <span class="pre">*</span> <span class="pre">x1</span></code> statement is correct.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">==</span> <span class="pre">1</span></code> too, we see that <code class="docutils literal notranslate"><span class="pre">f</span></code> reduces to just <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">r</span> <span class="pre">*</span> <span class="pre">x1</span></code> which is
just <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">x1</span></code> because we know <code class="docutils literal notranslate"><span class="pre">r</span> <span class="pre">==</span> <span class="pre">1</span></code> by initialization. The result is
correct for this case too.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">==</span> <span class="pre">0</span></code> though, the expression <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">r</span> <span class="pre">*</span> <span class="pre">x1</span></code> gives us the wrong answer.
The correct answer being <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">r</span></code> since in this case by initialization <code class="docutils literal notranslate"><span class="pre">r</span> <span class="pre">==</span> <span class="pre">1</span></code>.
We also saw above that if we let <code class="docutils literal notranslate"><span class="pre">pow_iter</span></code> run enough times so that <span class="math notranslate nohighlight">\(y_n = 0\)</span>,
we get our answer directly in <span class="math notranslate nohighlight">\(r_n\)</span> which we can return. Therefore to address the
“bug”, all we need to do are the following -</p>
<ol class="arabic simple">
<li><p>Change <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">r</span> <span class="pre">*</span> <span class="pre">x1;</span></code> to <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">r;</span></code>, and</p></li>
<li><p>Change <code class="docutils literal notranslate"><span class="pre">while</span> <span class="pre">(y1</span> <span class="pre">&gt;</span> <span class="pre">1)</span></code> to <code class="docutils literal notranslate"><span class="pre">while</span> <span class="pre">(y1</span> <span class="pre">&gt;</span> <span class="pre">0)</span></code></p></li>
</ol>
<p>The corrected program therefore is</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">f</span><span class="p">(</span><span class="nb">int</span> <span class="n">x</span><span class="p">,</span> <span class="nb">int</span> <span class="n">y</span><span class="p">)</span>
<span class="o">//</span><span class="nd">@requires</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span>
<span class="o">//</span><span class="nd">@ensures</span> \<span class="n">result</span> <span class="o">==</span> <span class="n">power_spec</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nb">int</span> <span class="n">x1</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
    <span class="nb">int</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
    <span class="nb">int</span> <span class="n">r</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">y1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">y1</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">x1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x1</span><span class="p">;</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">r</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p id="index-0">However, in writing in the above form, we’ve lost some important guarantees that we
worked out for <code class="docutils literal notranslate"><span class="pre">pow_iter</span></code> - its “invariant” <span class="math notranslate nohighlight">\({r_n}{x_n}^{y_n}\)</span> and how
the loop is supposed to end - i.e. with <span class="math notranslate nohighlight">\(y_n = 0\)</span>. The C0 language lets
us declare these using the <code class="docutils literal notranslate"><span class="pre">//&#64;loop_invariant</span></code> contract and a somewhat general
<code class="docutils literal notranslate"><span class="pre">//&#64;assert</span></code> contract. We can write:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">f</span><span class="p">(</span><span class="nb">int</span> <span class="n">x</span><span class="p">,</span> <span class="nb">int</span> <span class="n">y</span><span class="p">)</span>
<span class="o">//</span><span class="nd">@requires</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span>
<span class="o">//</span><span class="nd">@ensures</span> \<span class="n">result</span> <span class="o">==</span> <span class="n">power_spec</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nb">int</span> <span class="n">x1</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
    <span class="nb">int</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
    <span class="nb">int</span> <span class="n">r</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">y1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="o">//</span><span class="nd">@loop_invariant</span> <span class="n">y1</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="o">//</span><span class="nd">@loop_invariant</span> <span class="n">r</span> <span class="o">*</span> <span class="n">power_spec</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)</span> <span class="o">==</span> <span class="n">power_spec</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">y1</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">x1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x1</span><span class="p">;</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="o">//</span><span class="nd">@assert</span> <span class="n">y1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">r</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">y1</span> <span class="pre">&gt;=</span> <span class="pre">0</span></code> invariant is a requirement for us because otherwise we are not assured
of the safety of the <code class="docutils literal notranslate"><span class="pre">power_spec(x1,</span> <span class="pre">y1)</span></code> call.</p>
<p>There is one more easy to see fact about <code class="docutils literal notranslate"><span class="pre">pow_iter</span></code>: <span class="math notranslate nohighlight">\(y_{n+1} &lt; y_n\)</span>.
That’s true because in the even case, we have <span class="math notranslate nohighlight">\(y_{n+1} = y_{n} / 2\)</span> and for the
odd case, we have <span class="math notranslate nohighlight">\(y_{n+1} = (y_n - 1) / 2\)</span>. So in both cases, the inequality
will hold .. except when <span class="math notranslate nohighlight">\(y_n = 0\)</span>, but in that case we’re already done
and the loop wouldn’t have been entered in the first place.</p>
<p>There are other ways to fix the function.</p>
<ol class="arabic simple">
<li><p>Since we know that <code class="docutils literal notranslate"><span class="pre">f(x,y)</span></code> is misbehaving only for <code class="docutils literal notranslate"><span class="pre">y==0</span></code>, we can special case
case it by adding an <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">(y1</span> <span class="pre">==</span> <span class="pre">0)</span> <span class="pre">{</span> <span class="pre">return</span> <span class="pre">1;</span> <span class="pre">}</span></code> before the <code class="docutils literal notranslate"><span class="pre">while</span> <span class="pre">(y1</span> <span class="pre">&gt;</span> <span class="pre">0)</span></code>.</p></li>
<li><p>Since we now know that when <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">==</span> <span class="pre">0</span></code>, the return value should be <code class="docutils literal notranslate"><span class="pre">r</span></code> and not
<code class="docutils literal notranslate"><span class="pre">r</span> <span class="pre">*</span> <span class="pre">x1</span></code> and that the latter is correct of higher values of <code class="docutils literal notranslate"><span class="pre">y</span></code>, we can special
case the return statement as <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">(y</span> <span class="pre">==</span> <span class="pre">0)</span> <span class="pre">{</span> <span class="pre">return</span> <span class="pre">r;</span> <span class="pre">}</span> <span class="pre">else</span> <span class="pre">{</span> <span class="pre">return</span> <span class="pre">r</span> <span class="pre">*</span> <span class="pre">x1;</span> <span class="pre">}</span></code>.</p></li>
</ol>
<p>The fix where we modify the while loop and the return statement is considered a
better fix due to its greater generality. We’re showing that we trust the while
loop fully. Both the above fixes, on the other hand, add a special case without
considering the full validity of the while loop. This kind of a fix, in
general, indicates a reduced trust in the main part of the function – the
while loop – because by doing this, we show that we’re not confident that the
while loop is the correct thing to do.  Special cases also add complications to
analysis by adding new conditions (the “special cases”) to check for under
various circumstances.</p>
</section>
<section id="point-to-reasoning">
<span id="index-1"></span><h2>“Point-to” reasoning<a class="headerlink" href="#point-to-reasoning" title="Link to this heading">#</a></h2>
<p>What is the value to making those additional <code class="docutils literal notranslate"><span class="pre">//&#64;...</span></code> contract annotations
apart from the fact that C0 can check them for us? It is that every fact that
we want to know about in order to determine the correctness and safety of our
function <code class="docutils literal notranslate"><span class="pre">f</span></code> is now made explicit in the code itself. You do not need to
infer anything else given these annotations … apart maybe from some
mathematical facts.</p>
<ol class="arabic simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">//&#64;requires</span> <span class="pre">y</span> <span class="pre">&gt;=</span> <span class="pre">0;</span></code> and <code class="docutils literal notranslate"><span class="pre">//&#64;ensures</span> <span class="pre">\result</span> <span class="pre">==</span> <span class="pre">power_spec(x,y);</span></code>,
if they are never violated, gives us the necessary assurance to rely on <code class="docutils literal notranslate"><span class="pre">f</span></code>
– they assert both the <strong>safety</strong> and <strong>correctness</strong> of <code class="docutils literal notranslate"><span class="pre">f</span></code>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">//&#64;loop_invariant</span> <span class="pre">y1</span> <span class="pre">&gt;=</span> <span class="pre">0;</span></code> tells us that it is safe to make checking
calls to <code class="docutils literal notranslate"><span class="pre">power_spec(x1,y1)</span></code>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">//&#64;loop_invariant</span> <span class="pre">r1*power_spec(x1,y1)</span> <span class="pre">==</span> <span class="pre">power_spec(x,y);</span></code> tells us that
we don’t need to worry about the contents of the loop and can focus on how
the last value or <code class="docutils literal notranslate"><span class="pre">r</span></code> on exit (or even if the loop is never entered) gives
us the answer.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">//&#64;assert</span> <span class="pre">y1</span> <span class="pre">==</span> <span class="pre">0;</span></code> tells us that the <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">r;</span></code> is indeed the
correct result since <code class="docutils literal notranslate"><span class="pre">power_spec(x1,y1)</span></code> will then be 1.</p></li>
<li><p>Based on (4), we can reason that the <code class="docutils literal notranslate"><span class="pre">//&#64;ensures..</span></code> condition is indeed
true and therefore our function <code class="docutils literal notranslate"><span class="pre">f</span></code> is <strong>correct</strong>.</p></li>
</ol>
<p>Therefore any fact we need to use in our reasoning process is available in
the source directly and we can “point to” it.</p>
<p>Now, if every function written were to have such (verifiable) annotations,
won’t it be a pleasure to develop complex programs confidently?</p>
</section>
<section id="a-fine-point-about-loop-invariant">
<h2>A fine point about <code class="docutils literal notranslate"><span class="pre">&#64;loop_invariant</span></code><a class="headerlink" href="#a-fine-point-about-loop-invariant" title="Link to this heading">#</a></h2>
<p>Earlier, we considered loop invariants as a property of the loop iteration
function (such as <code class="docutils literal notranslate"><span class="pre">pow_iter</span></code>). While it is correct that it is a property that
the iteration function must meet, that is not the complete picture.</p>
<p>The loop invariant must also hold in the case when the loo body is never
entered.  This is ensured by C0’s implementation of <code class="docutils literal notranslate"><span class="pre">&#64;loop_invariant</span></code>. For our
power function, the <code class="docutils literal notranslate"><span class="pre">&#64;loop_invariant</span></code> check is as though the expanded form
were as shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>int f(int x, int y)
{
    //@requires y &gt;= 0;
    int r = 1;
    int x1 = x;
    int y1 = y;

LOOP:
    //@loop_invariant r * power_spec(x1, y1) == power_spec(x,y)
    if (!(y1 &gt; 0)) goto EXIT_LOOP;
    if (!(y1 % 2 == 1)) goto SKIP_R_UPDATE;
    r = r * x1;
SKIP_R_UPDATE:
    x1 = x1 * x1;
    y1 = y1 / 2;
    goto LOOP:

EXIT_LOOP:
    //@ensures \result == power_spec(x,y)
    return r;
}
</pre></div>
</div>
<p>So, in the above expanded form, we’ve made it explicit that the loop invariant
must hold even for the case <code class="docutils literal notranslate"><span class="pre">y1</span> <span class="pre">==</span> <span class="pre">0</span></code> when the while loop is not entered.
Therefore, the expression you place there must account for this too.</p>
<p>Another thing you might’ve noticed is that we declare our loop invariants
not as “functions whose values are preserved by the state changing actions
in the loop”, but as a boolean expression that must hold prior to loop
entry. This takes advantage of the fact that we without loss of generality,
a loop invariant can be restricted to produce a boolean result that must hold
true at all times.</p>
<p>To understand why, consider the mathematical formulation again –
<span class="math notranslate nohighlight">\(g(f^n(x)) = g(x_0)\)</span> being the property that the function <code class="docutils literal notranslate"><span class="pre">g</span></code> must
satisfy in order to be called an invariant of the iterable function <code class="docutils literal notranslate"><span class="pre">f</span></code>. If
that condition is to hold, we can express that as a boolean condition
equivalently – <span class="math notranslate nohighlight">\(g(\text{state}) == \text{constant}\)</span>.</p>
<p>Another way to look at it is that if <code class="docutils literal notranslate"><span class="pre">g</span></code> is an invariant of <code class="docutils literal notranslate"><span class="pre">f</span></code>,
then so is <span class="math notranslate nohighlight">\(h(x) = (g(x) == g(x_0))\)</span> which is a boolean function.</p>
<p>Operationally, using the “boolean invariant” approach eases the implementation
burden of C0 by merely requiring the compiler to insert a check at a single
point in the code, instead of having to track the value of a function
application within the loop.</p>
</section>
<section id="the-two-important-questions">
<h2>The two important questions<a class="headerlink" href="#the-two-important-questions" title="Link to this heading">#</a></h2>
<p>If you’re finding it hard grappling with proofs done in the “point to”
reasoning style, thinking about loop invariants, pre and post conditions
and such, here is something that might help you. You only need to remember
two important questions -</p>
<ol class="arabic simple">
<li><p>What do I know?</p></li>
<li><p>How do I know it?</p></li>
</ol>
<p>These two are surprisingly effective in a wide variety of areas spanning
personal thinking to work in deep science. We’ll leverage these here to
explain what we’re trying to do.</p>
<p>“What do I know?” - An answer to this question comes as some kind of factual
statement like “I know that the sun will rise tomorrow at 6am.” Of course, there
are fact-like statements that fit as answers to this question, not all of which
are true. For example, “Our ancestors are currently living on Neptune.” That
brings us to the next question -</p>
<p>“How do I know it?” - Gaps in the believability of a fact-sounding answer given
to the first question are expected to be filled by answers to this question.
“The sun has always risen at 6am on the 28th of August every year.” would be
a reasonable answer as it draws on inductive reasoning as an explanation.
Another candidate is to say “I know that the earth is a rotating sphere
and by the law of conservation of angular momentum, I expect it to continue
to spin until I see the sun rise tomorrow at 6am.”</p>
<p>As you see, The answer to the second question may itself invoke facts that fit
the “what do I know?” question. If these happened to be shared knowledge, then
the enquiry will usually stop there. If not, then you need to recursively ask
“how do I know <strong>that</strong>?” until you reach a point where the explanations are
satisfactory to the inquirer. In scientific research papers, many “how do you
know that?” questions that can come up along the way are answered by “pointing
to” another research paper that presented that fact and explained it.</p>
<p>How is this useful to us here?</p>
<p>When I give you a plain program like the one below and ask you “for what values
of m and n does this function produce the correct result?”, you might answer
“for m &gt; 0 and n &gt; 0”. Then I’ll ask you “how do you know that?” and you’ll have
to examine the code, perform some logical reasoning in your head and then
articulate that as an explanation.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">gcd</span><span class="p">(</span><span class="nb">int</span> <span class="n">m</span><span class="p">,</span> <span class="nb">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">m</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">int</span> <span class="n">m1</span> <span class="o">=</span> <span class="n">m</span> <span class="o">%</span> <span class="n">n</span><span class="p">;</span>
        <span class="nb">int</span> <span class="n">n1</span> <span class="o">=</span> <span class="n">n</span> <span class="o">%</span> <span class="n">m</span><span class="p">;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">m1</span><span class="p">;</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">n1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">m</span> <span class="o">+</span> <span class="n">n</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>On the other hand, if you instead give me the code below, and I ask you the same
question, you can just point me to the <code class="docutils literal notranslate"><span class="pre">&#64;requires</span></code> line  and say “because this
line says so”. Of course, the understanding here is that you’ve completed your
analysis of the function and what you can point to is factually accurate:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>int gcd(int m, int n)
//@requires m &gt; 0 &amp;&amp; n &gt; 0;
{
    while (m &gt; 0 &amp;&amp; n &gt; 0) {
        int m1 = m % n;
        int n1 = n % m;
        m = m1;
        n = n1;
    }
    return m + n;
}

So your task in declaring assertions about what your function does (i.e.
``@requires``, ``@ensures``, ``@loop_invariant`` and ``@assert``), both
internally and externally, is so that you can answer any such &quot;how do you
know that?&quot; question by pointing to some one line and saying &quot;because of
what that line says&quot;. It doesn&#39;t literally have to be one line always though
that&#39;s obviously preferrable. It can be two truths you know that are both
explicit in the code. However, if the question asked can reasonably be
expected to be asked again, it will be worth putting in an assertion that
can be pointed to as an explanation. If then someone asked &quot;how do you know
that the line 83 assertion is true?&quot;, then you can point to the other lines
and explain &quot;because lines 72 and 78 imply that&quot;, but by then, hopefully the
lines 72 and 78 evidently entail the assertion on line 83 without much
additional reasoning support.
</pre></div>
</div>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="warmup.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Warming up with the power function</p>
      </div>
    </a>
    <a class="right-next"
       href="c0.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">More C0</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-a-while-loop">What is a while loop?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#properties-of-the-iteration-function">Properties of the iteration function</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#point-to-reasoning">“Point-to” reasoning</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-fine-point-about-loop-invariant">A fine point about <code class="docutils literal notranslate"><span class="pre">@loop_invariant</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-two-important-questions">The two important questions</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Srikumar K. S.
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2021, Srikumar K. S..
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>